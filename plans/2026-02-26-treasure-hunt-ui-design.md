# 遛狗寻宝 — UI 设计方案

## 概述

基于 [遛狗寻宝 PRD](../prd/prd-treasure-hunt.md) 的 UI 交互设计方案。Treasure hunt 作为独立功能优先上线，在现有 App（Phase B 已上线）中新增寻宝 Tab。

### MVP 调整项（相对 PRD）

- **后台通知移出 MVP**：定位权限只请求"使用时允许"，不请求"始终允许"。PRD 中"App 在后台也能收到通知"移至后续迭代。后续可通过 iOS 渐进式权限升级引导用户开启。
- **积分宝箱领取模式**：所有宝箱均为限量竞争模式，后台设置库存数量，先到先得。

---

## 1. 页面结构

### Tab 入口

寻宝功能作为 App 底部 Tab 栏的独立 Tab，图标用宝箱造型。

### 寻宝模块页面清单

| 页面 | 层级 | 入口 |
|------|------|------|
| 寻宝地图 | Tab 主页 | 底部 Tab 栏 |
| 我的积分 | 二级页 | 地图顶部状态栏积分区域点击 |
| 我的券包 | 二级页 | 地图顶部状态栏券包图标点击 |
| 券详情 | 三级页 | 券包列表中券卡片"查看详情"点击 |

---

## 2. 寻宝地图主界面

### 布局（从上到下）

**顶部状态栏**
- 左侧：今日积分进度（如"今日 +85 分"）
- 中间：积分宝箱领取进度（如"3/10"）
- 右侧：券包图标（有新券时显示红点）
- 半透明背景，不遮挡地图
- 异常状态时，状态栏下方出现提示条

**地图区域**
- 全屏地图，以用户当前位置为中心
- 用户位置用遛狗主题的定位标记（非默认蓝点）
- 默认缩放展示周边约 500m
- 可手动缩放，宝箱加载范围最远 1km，超出不加载
- 宝箱图标下方显示距离标注（如"230m"）

**底部操作区**
- 左下角：筛选按钮（全部 / 积分宝箱 / 商家宝箱）
- 右下角：回到当前位置按钮
- 底部预留空间给开箱奖励卡片弹出

### 聚合显示

缩小地图时，相邻宝箱聚合为圆形数字气泡，气泡颜色取最高优先级宝箱类型（稀有 > 商家 > 积分）。

---

## 3. 宝箱视觉层级体系

### 宝箱类型

| 类型 | 图标 | 尺寸 | 特殊效果 |
|------|------|------|---------|
| 积分宝箱 | 木质宝箱 | 标准 | 无 |
| 商家宝箱 | 金色宝箱 | 略大于标准 | 无 |
| 稀有宝箱 | 对应类型图标 | 对应类型尺寸 | 紫色光环 |

> 光环体系预留扩展能力：未来不同等级项圈可对应不同颜色光环。MVP 先做紫色一档。

### 宝箱状态矩阵

| 状态 | 积分宝箱 | 商家宝箱 | 稀有宝箱 |
|------|---------|---------|---------|
| 未进入范围 | 正常显示 | 正常显示 | 对应图标 + 紫色光环 |
| 进入 50m | 变亮 + 弹跳 + 震动 | 变亮 + 弹跳 + 震动 | 变亮 + 弹跳 + 震动 + 光环加强 |
| 开箱中 | 开盖动画 0.8s | 开盖动画 0.8s | 开盖动画 + 额外粒子特效 |
| 已领取（自己） | 从地图消失 | "已领取"带勾标记，保留在地图 | 跟随对应类型规则 |
| 被他人领完 | 消失动画（渐隐 + 粒子散开）+ 顶部提示"这个宝箱刚被领走了" | 同左 | 同左 |
| 今日积分上限 | 变灰，不可点击 | 不受影响 | 跟随对应类型规则 |
| GPS 信号弱 | 半透明 | 半透明 | 半透明 |

---

## 4. 开箱交互流程

### 进入范围前

用户在地图上看到宝箱图标和距离标注，朝目标方向走。距离跟随 GPS 刷新实时更新。

### 进入 50m 范围

1. 宝箱图标变亮 + 轻微弹跳动画
2. 距离标注替换为"可开启"文字
3. 手机短促震动一次

### 点击开箱

1. 点击宝箱图标
2. 原位播放开箱动画（约 0.8s，宝箱盖打开 + 光效溢出；稀有宝箱额外粒子特效）
3. 动画结束后，底部滑出奖励卡片

### 奖励卡片 — 积分宝箱

- 卡片高度约屏幕 1/4
- 内容：金币图标 + "+15 积分"大字 + 当前累计积分小字
- 关闭方式：点击空白区域或下滑
- 关闭后回到地图继续

### 奖励卡片 — 商家宝箱

- 卡片高度约屏幕 1/3
- 内容：商家 logo + 商家名称 + 券面信息（如"满50减10"）+ 有效期 + 额外积分奖励
- 底部按钮："查看详情"（进入券详情页）和"关闭"
- 券自动存入券包

### 被抢走时

宝箱被他人领完后，地图上该宝箱播放消失动画（渐隐 + 粒子散开）。如果用户正在走向这个宝箱，顶部出现提示条："这个宝箱刚被领走了"。实时同步，尽早告知。

---

## 5. 积分页与券包页

### 我的积分

- 入口：点击地图顶部状态栏积分区域
- 顶部：当前积分余额 + 有效期提示（"最早一批积分将于 xx 天后过期"）
- 主体：积分流水列表（时间、来源、数量），按日期倒序
- 底部：占位文案"积分商城即将上线，敬请期待"（MVP 不做积分商城）

### 我的券包

- 入口：地图顶部状态栏右侧券包图标，有新券时显示红点
- 顶部 Tab 栏：未使用 / 已过期
- 券卡片：商家名称 + 券面信息 + 有效期 + "去使用"按钮
- 点击"去使用"进入券详情页

### 券详情页

- 完整使用规则说明
- 商家地址
- 一键导航按钮（调起系统地图 App）

---

## 6. 异常状态与空状态

### 设计原则

非阻断问题用提示条或视觉状态变化；阻断性问题才用全屏引导。保持用户在地图上的时间最大化。

### 状态清单

| 场景 | 处理方式 | 类型 |
|------|---------|------|
| GPS 精度 >100m | 宝箱图标全部半透明，顶部提示条"定位信号弱，请移到开阔地带" | 提示条 |
| 每日积分宝箱已领满 10 个 | 积分宝箱变灰，点击提示"今日积分宝箱已领完，明天再来"。商家宝箱不受影响 | 视觉状态 |
| 每日积分上限 200 分 | 同上，与领取上限两个独立限制，先触发的先生效 | 视觉状态 |
| 附近无宝箱 | 地图中央插画提示"附近暂无宝箱，换个地方遛遛看" | 空状态 |
| 所在城市未开放 | 地图中央提示"当前区域暂未开放寻宝，敬请期待" | 空状态 |
| 网络异常 | 地图用缓存瓦片，顶部提示条"网络异常，宝箱信息加载失败"+ 重试按钮 | 提示条 |
| 定位权限未授权 | 全屏引导页"寻宝需要定位权限才能使用"+"去设置"按钮 | 全屏引导 |

---

## 7. 消息提醒与每日节奏

### 前台提醒（MVP 范围）

| 触发时机 | 表现 |
|---------|------|
| 进入宝箱 50m 范围 | 宝箱弹跳动画 + 短震动 |
| 开箱成功 | 奖励卡片弹出 |
| 宝箱被他人领走 | 消失动画 + 顶部提示条 |

### 每日刷新感知

积分宝箱每日凌晨刷新。用户当天首次打开寻宝 Tab 时，地图上宝箱依次"蹦出"的入场动画（快速连续，约 1.5s 内全部出现），传达"今天有新宝箱了"的感知。顶部状态栏进度重置为"0/10"。

### 不做（MVP）

- 后台推送通知（需"始终允许"定位权限）
- "今日还有 N 个宝箱未领"催促推送
- 每日遛狗提醒（属于 Phase B 的 F14）

---

## 版本记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2026-02-26 | 初版 UI 设计方案 |
